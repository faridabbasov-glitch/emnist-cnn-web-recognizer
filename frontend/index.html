<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Neural Ink — Character Recognition</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;700;800&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --bg: #0a0a0f;
    --surface: #12121a;
    --surface2: #1a1a26;
    --accent: #00f5c4;
    --accent2: #ff3d71;
    --accent3: #a78bfa;
    --text: #e8e8f0;
    --muted: #5a5a7a;
    --border: rgba(255,255,255,0.07);
    --glow: 0 0 40px rgba(0,245,196,0.15);
  }

  html, body {
    height: 100%;
    background: var(--bg);
    color: var(--text);
    font-family: 'Space Mono', monospace;
    overflow-x: hidden;
  }

  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.03'/%3E%3C/svg%3E");
    opacity: 0.4;
    pointer-events: none;
    z-index: 0;
  }

  body::after {
    content: '';
    position: fixed;
    inset: 0;
    background-image:
      linear-gradient(rgba(0,245,196,0.03) 1px, transparent 1px),
      linear-gradient(90deg, rgba(0,245,196,0.03) 1px, transparent 1px);
    background-size: 60px 60px;
    pointer-events: none;
    z-index: 0;
  }

  .wrapper {
    position: relative;
    z-index: 1;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 40px 20px 60px;
  }

  header {
    text-align: center;
    margin-bottom: 50px;
    animation: fadeDown 0.8s ease both;
  }

  .logo-eyebrow {
    font-family: 'Space Mono', monospace;
    font-size: 11px;
    letter-spacing: 0.4em;
    color: var(--accent);
    text-transform: uppercase;
    margin-bottom: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
  }

  .logo-eyebrow::before, .logo-eyebrow::after {
    content: '';
    width: 40px;
    height: 1px;
    background: var(--accent);
    opacity: 0.4;
  }

  h1 {
    font-family: 'Syne', sans-serif;
    font-weight: 800;
    font-size: clamp(36px, 7vw, 72px);
    line-height: 0.95;
    letter-spacing: -0.03em;
    background: linear-gradient(135deg, #ffffff 0%, var(--accent) 50%, var(--accent3) 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .subtitle {
    margin-top: 14px;
    font-size: 13px;
    color: var(--muted);
    letter-spacing: 0.05em;
  }

  .main-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 24px;
    width: 100%;
    max-width: 860px;
    animation: fadeUp 0.9s 0.2s ease both;
  }

  @media (max-width: 640px) {
    .main-grid { grid-template-columns: 1fr; }
  }

  .card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 20px;
    padding: 28px;
    position: relative;
    overflow: hidden;
    transition: border-color 0.3s, box-shadow 0.3s;
  }

  .card::before {
    content: '';
    position: absolute;
    inset: 0;
    border-radius: 20px;
    background: radial-gradient(circle at 50% 0%, rgba(0,245,196,0.05) 0%, transparent 70%);
    pointer-events: none;
  }

  .card:hover {
    border-color: rgba(0,245,196,0.2);
    box-shadow: var(--glow);
  }

  .card-label {
    font-size: 10px;
    letter-spacing: 0.3em;
    color: var(--accent);
    text-transform: uppercase;
    margin-bottom: 16px;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .card-label .dot {
    width: 6px; height: 6px;
    border-radius: 50%;
    background: var(--accent);
    box-shadow: 0 0 8px var(--accent);
    animation: pulse-dot 2s ease-in-out infinite;
  }

  #canvas-wrap {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 16px;
  }

  canvas {
    cursor: crosshair;
    border-radius: 12px;
    border: 1.5px solid var(--border);
    background: #000;
    display: block;
    width: 100%;
    aspect-ratio: 1;
    max-width: 320px;
    touch-action: none;
    transition: border-color 0.3s, box-shadow 0.3s;
  }

  canvas.drawing {
    border-color: var(--accent);
    box-shadow: 0 0 20px rgba(0,245,196,0.2);
  }

  .canvas-hint {
    font-size: 11px;
    color: var(--muted);
    text-align: center;
    letter-spacing: 0.05em;
  }

  .btn-row {
    display: flex;
    gap: 10px;
    width: 100%;
    max-width: 320px;
  }

  .btn {
    flex: 1;
    padding: 12px;
    border: none;
    border-radius: 10px;
    font-family: 'Space Mono', monospace;
    font-size: 12px;
    font-weight: 700;
    letter-spacing: 0.08em;
    cursor: pointer;
    transition: all 0.2s;
    position: relative;
    overflow: hidden;
  }

  .btn::after {
    content: '';
    position: absolute;
    inset: 0;
    background: white;
    opacity: 0;
    transition: opacity 0.15s;
  }

  .btn:active::after { opacity: 0.1; }

  .btn-primary { background: var(--accent); color: #000; }
  .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 6px 24px rgba(0,245,196,0.35); }

  .btn-secondary { background: var(--surface2); color: var(--muted); border: 1px solid var(--border); }
  .btn-secondary:hover { background: #22223a; color: var(--text); border-color: rgba(255,255,255,0.15); }

  .results-panel { display: flex; flex-direction: column; gap: 0; }

  .idle-state {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 14px;
    padding: 40px 0;
    color: var(--muted);
    font-size: 12px;
    text-align: center;
    letter-spacing: 0.05em;
  }

  .idle-icon {
    width: 56px; height: 56px;
    border-radius: 50%;
    border: 1.5px dashed var(--muted);
    display: flex; align-items: center; justify-content: center;
    font-size: 24px;
    opacity: 0.4;
  }

  .spinner {
    display: none;
    align-items: center;
    justify-content: center;
    padding: 40px 0;
    gap: 12px;
    flex-direction: column;
    color: var(--muted);
    font-size: 11px;
    letter-spacing: 0.1em;
  }

  .spinner.active { display: flex; }

  .spin-ring {
    width: 40px; height: 40px;
    border-radius: 50%;
    border: 2px solid var(--border);
    border-top-color: var(--accent);
    animation: spin 0.8s linear infinite;
  }

  .predictions { display: none; flex-direction: column; gap: 14px; }
  .predictions.active { display: flex; }

  .pred-item {
    position: relative;
    padding: 16px 18px;
    border-radius: 12px;
    border: 1.5px solid var(--border);
    background: var(--surface2);
    overflow: hidden;
    animation: slideIn 0.4s ease both;
  }

  .pred-item:nth-child(1) { animation-delay: 0s; }
  .pred-item:nth-child(2) { animation-delay: 0.07s; }
  .pred-item:nth-child(3) { animation-delay: 0.14s; }

  .pred-item.top {
    border-color: rgba(0,245,196,0.3);
    background: linear-gradient(135deg, rgba(0,245,196,0.05), var(--surface2));
  }

  .pred-fill {
    position: absolute;
    inset: 0;
    background: linear-gradient(90deg, rgba(0,245,196,0.07), transparent);
    transform-origin: left;
    animation: fillBar 0.6s ease both;
  }

  .pred-fill.secondary { background: linear-gradient(90deg, rgba(167,139,250,0.07), transparent); }
  .pred-fill.tertiary  { background: linear-gradient(90deg, rgba(255,61,113,0.05), transparent); }

  .pred-content {
    position: relative;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 10px;
  }

  .pred-rank {
    font-size: 10px;
    color: var(--muted);
    letter-spacing: 0.2em;
    min-width: 24px;
    line-height: 1;
  }

  .pred-label {
    font-family: 'Syne', sans-serif;
    font-weight: 700;
    font-size: 20px;
    flex: 1;
    letter-spacing: -0.02em;
    line-height: 1;
  }

  .pred-item.top .pred-label { color: var(--accent); }
  .pred-item:nth-child(2) .pred-label { color: var(--accent3); }
  .pred-item:nth-child(3) .pred-label { color: var(--muted); }

  .pred-conf {
    text-align: right;
    line-height: 1;
  }

  .pred-pct {
    font-size: 14px;
    font-weight: 700;
    font-family: 'Space Mono', monospace;
    line-height: 1;
    display: inline;
  }

  .pred-item.top .pred-pct { color: var(--accent); }

  .pred-bar-wrap {
    margin-top: 8px;
    height: 3px;
    background: rgba(255,255,255,0.06);
    border-radius: 2px;
    overflow: hidden;
  }

  .pred-bar { height: 100%; border-radius: 2px; animation: growBar 0.7s ease both; }
  .pred-item.top .pred-bar { background: var(--accent); box-shadow: 0 0 8px var(--accent); }
  .pred-item:nth-child(2) .pred-bar { background: var(--accent3); }
  .pred-item:nth-child(3) .pred-bar { background: var(--accent2); opacity: 0.6; }

  .history-strip {
    width: 100%;
    max-width: 860px;
    margin-top: 20px;
    animation: fadeUp 1s 0.4s ease both;
  }

  .history-label {
    font-size: 10px;
    letter-spacing: 0.3em;
    color: var(--muted);
    text-transform: uppercase;
    margin-bottom: 12px;
    display: flex; align-items: center; gap: 8px;
  }

  .history-label::after { content: ''; flex: 1; height: 1px; background: var(--border); }

  .history-items {
    display: flex;
    gap: 10px;
    overflow-x: auto;
    padding-bottom: 4px;
    scrollbar-width: none;
  }

  .history-items::-webkit-scrollbar { display: none; }

  .hist-chip {
    flex-shrink: 0;
    padding: 8px 14px;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 8px;
    font-size: 13px;
    font-family: 'Syne', sans-serif;
    font-weight: 700;
    color: var(--accent);
    animation: popIn 0.3s ease both;
  }

  .error-msg {
    display: none;
    padding: 14px 18px;
    border-radius: 12px;
    background: rgba(255,61,113,0.08);
    border: 1px solid rgba(255,61,113,0.2);
    color: var(--accent2);
    font-size: 12px;
    letter-spacing: 0.03em;
  }

  .error-msg.active { display: block; animation: slideIn 0.3s ease both; }

  @keyframes fadeDown { from { opacity:0; transform: translateY(-20px); } to { opacity:1; transform: translateY(0); } }
  @keyframes fadeUp   { from { opacity:0; transform: translateY(24px);  } to { opacity:1; transform: translateY(0); } }
  @keyframes slideIn  { from { opacity:0; transform: translateX(-12px); } to { opacity:1; transform: translateX(0); } }
  @keyframes popIn    { from { opacity:0; transform: scale(0.85); }        to { opacity:1; transform: scale(1); } }
  @keyframes spin     { to { transform: rotate(360deg); } }
  @keyframes pulse-dot {
    0%, 100% { opacity: 1; transform: scale(1); }
    50%       { opacity: 0.4; transform: scale(0.7); }
  }
  @keyframes growBar  { from { width: 0; } }
  @keyframes fillBar  { from { transform: scaleX(0); } }
</style>
</head>
<body>
<div class="wrapper">

  <header>
    <div class="logo-eyebrow">neural ink</div>
    <h1>DRAW<br>DETECT</h1>
    <p class="subtitle">Real-time recognition powered by neural networks</p>
  </header>

  <div class="main-grid">
    <div class="card">
      <div class="card-label"><span class="dot"></span>Canvas</div>
      <div id="canvas-wrap">
        <canvas id="canvas" width="280" height="280"></canvas>
        <p class="canvas-hint">Click &amp; drag to draw · Touch supported</p>
        <div class="btn-row">
          <button class="btn btn-primary" id="predictBtn">PREDICT →</button>
          <button class="btn btn-secondary" id="clearBtn">CLEAR</button>
        </div>
      </div>
    </div>

    <div class="card results-panel">
      <div class="card-label"><span class="dot"></span>Results</div>
      <div class="idle-state" id="idleState">
        <div class="idle-icon">✦</div>
        <span>Draw something on the canvas,<br>then hit PREDICT</span>
      </div>
      <div class="spinner" id="spinner">
        <div class="spin-ring"></div>
        <span>ANALYZING...</span>
      </div>
      <div class="predictions" id="predictions"></div>
      <div class="error-msg" id="errorMsg"></div>
    </div>
  </div>

  <div class="history-strip" id="historyStrip" style="display:none">
    <div class="history-label">History</div>
    <div class="history-items" id="historyItems"></div>
  </div>

</div>
<script>
const canvas      = document.getElementById('canvas');
const ctx         = canvas.getContext('2d');
const predictBtn  = document.getElementById('predictBtn');
const clearBtn    = document.getElementById('clearBtn');
const idleState   = document.getElementById('idleState');
const spinner     = document.getElementById('spinner');
const predictions = document.getElementById('predictions');
const errorMsg    = document.getElementById('errorMsg');
const historyStrip  = document.getElementById('historyStrip');
const historyItems  = document.getElementById('historyItems');

ctx.fillStyle = '#000';
ctx.fillRect(0, 0, canvas.width, canvas.height);
ctx.strokeStyle = '#fff';
ctx.lineWidth = 18;
ctx.lineCap = 'round';
ctx.lineJoin = 'round';

let drawing = false, hasDrawn = false, lastX = 0, lastY = 0;

function getPos(e) {
  const rect = canvas.getBoundingClientRect();
  const sx = canvas.width / rect.width, sy = canvas.height / rect.height;
  if (e.touches) return [(e.touches[0].clientX - rect.left) * sx, (e.touches[0].clientY - rect.top) * sy];
  return [(e.clientX - rect.left) * sx, (e.clientY - rect.top) * sy];
}

function startDraw(e) { e.preventDefault(); drawing = true; hasDrawn = true; [lastX, lastY] = getPos(e); canvas.classList.add('drawing'); }
function draw(e) {
  if (!drawing) return; e.preventDefault();
  const [x, y] = getPos(e);
  ctx.beginPath(); ctx.moveTo(lastX, lastY); ctx.lineTo(x, y); ctx.stroke();
  [lastX, lastY] = [x, y];
}
function stopDraw() { drawing = false; canvas.classList.remove('drawing'); }

canvas.addEventListener('mousedown', startDraw);
canvas.addEventListener('mousemove', draw);
canvas.addEventListener('mouseup', stopDraw);
canvas.addEventListener('mouseleave', stopDraw);
canvas.addEventListener('touchstart', startDraw, { passive: false });
canvas.addEventListener('touchmove', draw, { passive: false });
canvas.addEventListener('touchend', stopDraw);

clearBtn.addEventListener('click', () => {
  ctx.fillStyle = '#000'; ctx.fillRect(0, 0, canvas.width, canvas.height);
  hasDrawn = false;
  idleState.style.display = '';
  spinner.classList.remove('active');
  predictions.classList.remove('active');
  errorMsg.classList.remove('active');
  predictions.innerHTML = '';
});

const ranks = ['#1','#2','#3'], fills = ['','secondary','tertiary'], tops = ['top','',''];

predictBtn.addEventListener('click', async () => {
  if (!hasDrawn) return;
  idleState.style.display = 'none';
  spinner.classList.add('active');
  predictions.classList.remove('active');
  errorMsg.classList.remove('active');
  predictions.innerHTML = '';

  try {
    const res = await fetch('/predict', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ image: canvas.toDataURL('image/png') })
    });
    if (!res.ok) throw new Error(`Server error ${res.status}`);
    const data = await res.json();
    spinner.classList.remove('active');
    if (!data.predictions?.length) { showError('No predictions returned.'); return; }

    data.predictions.forEach((p, i) => {
      const pct = Math.round(p.confidence * 100);
      const el = document.createElement('div');
      el.className = `pred-item ${tops[i]}`;
      el.innerHTML = `
        <div class="pred-fill ${fills[i]}" style="transform:scaleX(${p.confidence})"></div>
        <div class="pred-content">
          <span class="pred-rank">${ranks[i]}</span>
          <span class="pred-label">${p.label}</span>
          <div class="pred-conf"><span class="pred-pct">${pct}%</span></div>
        </div>
        <div class="pred-bar-wrap"><div class="pred-bar" style="width:${pct}%"></div></div>
      `;
      predictions.appendChild(el);
    });

    predictions.classList.add('active');
    addHistory(data.predictions[0].label);
  } catch(err) {
    spinner.classList.remove('active');
    showError('Error: ' + err.message);
  }
});

function showError(msg) { errorMsg.textContent = msg; errorMsg.classList.add('active'); }
function addHistory(label) {
  historyStrip.style.display = '';
  const chip = document.createElement('div');
  chip.className = 'hist-chip';
  chip.textContent = label;
  historyItems.prepend(chip);
  if (historyItems.children.length > 12) historyItems.lastChild.remove();
}
</script>
</body>
</html>